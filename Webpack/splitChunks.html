<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.41">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <link rel="icon" href="./avator.png"><title>代码分离优化首屏加载 | op-chen's Blog</title><meta name="description" content="op-chen's Blog">
    <link rel="modulepreload" href="/Blog/assets/app.75b803a6.js"><link rel="modulepreload" href="/Blog/assets/splitChunks.html.b647a730.js"><link rel="modulepreload" href="/Blog/assets/splitChunks.html.4070ad5e.js"><link rel="prefetch" href="/Blog/assets/index.html.453cd0b3.js"><link rel="prefetch" href="/Blog/assets/github-page.html.5585320a.js"><link rel="prefetch" href="/Blog/assets/vuepress-mermaid.html.29686719.js"><link rel="prefetch" href="/Blog/assets/handwrite.html.226b9669.js"><link rel="prefetch" href="/Blog/assets/usestate-source.html.8a2ffc22.js"><link rel="prefetch" href="/Blog/assets/suspended-ball.html.6995c0b0.js"><link rel="prefetch" href="/Blog/assets/vscode-plugin-start.html.e63ebc01.js"><link rel="prefetch" href="/Blog/assets/module.html.9113dca3.js"><link rel="prefetch" href="/Blog/assets/404.html.f166316b.js"><link rel="prefetch" href="/Blog/assets/index.html.7feff3ab.js"><link rel="prefetch" href="/Blog/assets/github-page.html.781f7ee6.js"><link rel="prefetch" href="/Blog/assets/vuepress-mermaid.html.a50f5782.js"><link rel="prefetch" href="/Blog/assets/handwrite.html.e75507fd.js"><link rel="prefetch" href="/Blog/assets/usestate-source.html.8fda19dc.js"><link rel="prefetch" href="/Blog/assets/suspended-ball.html.72fe3194.js"><link rel="prefetch" href="/Blog/assets/vscode-plugin-start.html.b8ea5553.js"><link rel="prefetch" href="/Blog/assets/module.html.aba74faf.js"><link rel="prefetch" href="/Blog/assets/404.html.d6f4fef0.js"><link rel="prefetch" href="/Blog/assets/404.d643dd98.js"><link rel="prefetch" href="/Blog/assets/Layout.fc962e44.js">
    <link rel="stylesheet" href="/Blog/assets/style.569f359f.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/Blog/" class=""><img class="logo" src="/Blog/./avator.png" alt="op-chen&#39;s Blog"><span class="site-name can-hide">op-chen&#39;s Blog</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a href="/Blog/" class="" aria-label="Home"><!--[--><!--]--> Home <!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/DBSDs" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-dark-button" title="toggle dark mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a href="/Blog/" class="" aria-label="Home"><!--[--><!--]--> Home <!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/DBSDs" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading collapsible">JS相关 <span class="right arrow"></span></p><!--[--><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a href="/Blog/Js/handwrite.html" class="sidebar-item" aria-label="在面试中手写的算法或者JS编程题"><!--[--><!--]--> 在面试中手写的算法或者JS编程题 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><p tabindex="0" class="sidebar-item sidebar-heading collapsible">Css相关 <span class="right arrow"></span></p><!--[--><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a href="/Blog/Css/suspended-ball.html" class="sidebar-item" aria-label="transition、animation实现动画方式"><!--[--><!--]--> transition、animation实现动画方式 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><p tabindex="0" class="sidebar-item sidebar-heading collapsible">搭建博客 <span class="right arrow"></span></p><!--[--><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a href="/Blog/Blog/github-page.html" class="sidebar-item" aria-label="免费的搭建一个自己的博客"><!--[--><!--]--> 免费的搭建一个自己的博客 <!--[--><!--]--></a><!----></li><li><a href="/Blog/Blog/vuepress-mermaid.html" class="sidebar-item" aria-label="博客流程图(编写markdown-it插件)"><!--[--><!--]--> 博客流程图(编写markdown-it插件) <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><p tabindex="0" class="sidebar-item sidebar-heading active collapsible">Webpack实践 <span class="down arrow"></span></p><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/Blog/Webpack/splitChunks.html" class="router-link-active router-link-exact-active router-link-active sidebar-item active" aria-label="代码分离优化首屏加载"><!--[--><!--]--> 代码分离优化首屏加载 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/Blog/Webpack/splitChunks.html#_1-背景" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.背景"><!--[--><!--]--> 1.背景 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Blog/Webpack/splitChunks.html#_2-优化手段" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.优化手段"><!--[--><!--]--> 2.优化手段 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Blog/Webpack/splitChunks.html#_3-splitchunksplugin" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.SplitChunksPlugin"><!--[--><!--]--> 3.SplitChunksPlugin <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Blog/Webpack/splitChunks.html#_4-第三方依赖动态加载-懒加载" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.第三方依赖动态加载（懒加载）"><!--[--><!--]--> 4.第三方依赖动态加载（懒加载） <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Blog/Webpack/splitChunks.html#_5-继续分包" class="router-link-active router-link-exact-active sidebar-item" aria-label="5.继续分包"><!--[--><!--]--> 5.继续分包 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Blog/Webpack/splitChunks.html#附1-编译问题" class="router-link-active router-link-exact-active sidebar-item" aria-label="附1:编译问题"><!--[--><!--]--> 附1:编译问题 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Blog/Webpack/splitChunks.html#附2-继续优化" class="router-link-active router-link-exact-active sidebar-item" aria-label="附2:继续优化"><!--[--><!--]--> 附2:继续优化 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a href="/Blog/Webpack/module.html" class="sidebar-item" aria-label="全面了解JS中的Module"><!--[--><!--]--> 全面了解JS中的Module <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h1 id="代码分离优化首屏加载" tabindex="-1"><a class="header-anchor" href="#代码分离优化首屏加载" aria-hidden="true">#</a> 代码分离优化首屏加载</h1><h2 id="_1-背景" tabindex="-1"><a class="header-anchor" href="#_1-背景" aria-hidden="true">#</a> 1.背景</h2><p>在开发过程中，发现首屏加载过慢导致用户体验不佳(大约需要10秒左右)。</p><blockquote><p>造成原因是因为我们使用的前端工程化程度不够，原本是将所有的文件通过webpack打包后放在一个文件中，大约为60+MB。<br> 因此我们首先想到的就是使用代码分离的方法将多个包分离</p></blockquote><p>在优化过程中可谓是踩坑无数，百思不得其解，到最后发现是不过如此。但是网上一篇完整的叙述都很少，经常是使用webpack的默认例子。因此想要写篇博文来记录一下自己的一些实践。</p><h2 id="_2-优化手段" tabindex="-1"><a class="header-anchor" href="#_2-优化手段" aria-hidden="true">#</a> 2.优化手段</h2><p>首先明确目标，是使用代码分离的方式来优化首屏加载速度，优化的流程大致如下：</p><div class="spinner" style="background:rgb(66, 185, 131);" data-v-cbcc8fac></div><p>在webpack中有关于代码分离的<a href="https://webpack.docschina.org/guides/code-splitting#root" target="_blank" rel="noopener noreferrer">文档介绍<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 总的来说webpack是可以帮助我们做到资源的去重和分离，去重就是将重复的引用减少，<strong>分离将不同的资源包分离在不同的包内</strong></p><h2 id="_3-splitchunksplugin" tabindex="-1"><a class="header-anchor" href="#_3-splitchunksplugin" aria-hidden="true">#</a> 3.SplitChunksPlugin</h2><p>我们很快地找到这个插件和配置，应该才是webpack帮助代码分离的关键 其默认配置为</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">//...</span>
  <span class="token literal-property property">optimization</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">splitChunks</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">chunks</span><span class="token operator">:</span> <span class="token string">&#39;async&#39;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">minSize</span><span class="token operator">:</span> <span class="token number">20000</span><span class="token punctuation">,</span>
      <span class="token literal-property property">minRemainingSize</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
      <span class="token literal-property property">minChunks</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
      <span class="token literal-property property">maxAsyncRequests</span><span class="token operator">:</span> <span class="token number">30</span><span class="token punctuation">,</span>
      <span class="token literal-property property">maxInitialRequests</span><span class="token operator">:</span> <span class="token number">30</span><span class="token punctuation">,</span>
      <span class="token literal-property property">enforceSizeThreshold</span><span class="token operator">:</span> <span class="token number">50000</span><span class="token punctuation">,</span>
      <span class="token literal-property property">cacheGroups</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">defaultVendors</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[\\/]node_modules[\\/]</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
          <span class="token literal-property property">priority</span><span class="token operator">:</span> <span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">,</span>
          <span class="token literal-property property">reuseExistingChunk</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token keyword">default</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">minChunks</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
          <span class="token literal-property property">priority</span><span class="token operator">:</span> <span class="token operator">-</span><span class="token number">20</span><span class="token punctuation">,</span>
          <span class="token literal-property property">reuseExistingChunk</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><p>通过默认配置我们可以看到我们分了两个包，cacheGroup和default，可是在实践中分离的包呢？ 别急！其实主要是在chunks中已经有其设置，关键字为&quot;async&quot;，该关键字是说明只有代码为<strong>主包未立即引入的第三方依赖，才会进入到此cacheGruop中</strong>来。所以添加<strong>chunks:&quot;initial&quot;</strong></p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code> <span class="token literal-property property">defaultVendors</span><span class="token operator">:</span> <span class="token punctuation">{</span>
	<span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[\\/]node_modules[\\/]</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
 	<span class="token literal-property property">priority</span><span class="token operator">:</span> <span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">,</span>
    <span class="token literal-property property">chunks</span><span class="token operator">:</span> <span class="token string">&#39;initial&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">reuseExistingChunk</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>就可以看到<strong>在首屏加载</strong>的时候，我们的defaultVendors 包出现了！</p><h2 id="_4-第三方依赖动态加载-懒加载" tabindex="-1"><a class="header-anchor" href="#_4-第三方依赖动态加载-懒加载" aria-hidden="true">#</a> 4.第三方依赖动态加载（懒加载）</h2><p>那么如何将我们的第三方插件在需要的时候才加载呢，这个时候就需要用到我们的<strong>动态加载</strong>了，在webpack中也有过js动态加载的描述，主要是通过ECMAScript 提案 的 import() 语法 或require.ensure来实现 不过三大框架均有自己推荐的动态导入方案：</p><blockquote><ul><li>React: <a href="https://reactjs.org/docs/code-splitting.html" target="_blank" rel="noopener noreferrer">Code Splitting and Lazy Loading<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li>Vue: <a href="https://vuedose.tips/dynamic-imports-in-vue-js-for-better-performance" target="_blank" rel="noopener noreferrer">Dynamic Imports in Vue.js for better performance<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li>Angular: <a href="https://angular.io/guide/router#milestone-6-asynchronous-routing" target="_blank" rel="noopener noreferrer">Lazy Loading route configuration and AngularJS + webpack = lazyLoad<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ul></blockquote><p>因此只要通过推荐的方案进行动态导入</p><blockquote><p>一般而言针对单页面spa网站，将<strong>路由懒加载</strong>就可以将大多数首屏不需要的第三方依赖抽离出来 设置好引入后，那么我们的第三方依赖就成功从主程序中抽离出来</p></blockquote><h2 id="_5-继续分包" tabindex="-1"><a class="header-anchor" href="#_5-继续分包" aria-hidden="true">#</a> 5.继续分包</h2><p>然而很多时候，一股脑将第三方包在某一路由加载时，<strong>异步地将一个包加载进入程序中</strong>，不是一个很好的选择。<br> 配置优化，一般而言这个时候就需要用到webpack打包分析的插件<a href="https://github.com/webpack-contrib/webpack-bundle-analyzer" target="_blank" rel="noopener noreferrer">webpack-bundle-analyzer<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>，通过插件可以分析出你的bundle，一般而言将<strong>某些大库分成不同的包就可以了</strong>。 这里附上将monaco，echarts,xlsx分离的示例：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">//...</span>
	<span class="token literal-property property">optimization</span><span class="token operator">:</span> <span class="token punctuation">{</span>
 		<span class="token comment">//...</span>
		<span class="token literal-property property">cacheGroups</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  		<span class="token comment">//...</span>
			<span class="token literal-property property">monaco</span><span class="token operator">:</span> <span class="token punctuation">{</span>
				<span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[\\/]monaco-editor[\\/]</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
				<span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;monaco&#39;</span><span class="token punctuation">,</span>
				<span class="token literal-property property">reuseExistingChunk</span><span class="token operator">:</span> <span class="token boolean">true</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token literal-property property">echarts</span><span class="token operator">:</span> <span class="token punctuation">{</span>
				<span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[\\/](echarts-for-react|echarts|zrender)[\\/]</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
				<span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;echarts&#39;</span><span class="token punctuation">,</span>
				<span class="token literal-property property">reuseExistingChunk</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token literal-property property">xlsx</span><span class="token operator">:</span> <span class="token punctuation">{</span>
				<span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[\\/]xlsx[\\/]</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
				<span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;xlsx&#39;</span><span class="token punctuation">,</span>
				<span class="token literal-property property">reuseExistingChunk</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p><strong>这样就将某些大库分成小小包，在将在特定路由的时候加载小小包就可以了。</strong></p><h2 id="附1-编译问题" tabindex="-1"><a class="header-anchor" href="#附1-编译问题" aria-hidden="true">#</a> 附1:编译问题</h2><p>在项目实践中发现动态引入一直无效，没有被webpack的splitChunks识别为动态的引入。可以从<strong>ts编译</strong>和<strong>babel编译</strong>入手 这里将ts的&quot;module&quot;:改写成&quot;es2020&quot;及以上才可以被识别动态导入，附上我们的配置</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
	<span class="token property">&quot;compilerOptions&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
		<span class="token property">&quot;experimentalDecorators&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
		<span class="token property">&quot;target&quot;</span><span class="token operator">:</span> <span class="token string">&quot;es5&quot;</span><span class="token punctuation">,</span>
		<span class="token property">&quot;lib&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;es5&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;es6&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;dom&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
		<span class="token property">&quot;jsx&quot;</span><span class="token operator">:</span> <span class="token string">&quot;react&quot;</span><span class="token punctuation">,</span>
		<span class="token property">&quot;module&quot;</span><span class="token operator">:</span> <span class="token string">&quot;es2020&quot;</span><span class="token punctuation">,</span>
		<span class="token property">&quot;allowSyntheticDefaultImports&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
		<span class="token property">&quot;skipLibCheck&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
		<span class="token property">&quot;resolveJsonModule&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
		<span class="token property">&quot;moduleResolution&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node&quot;</span><span class="token punctuation">,</span>
		<span class="token property">&quot;baseUrl&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./&quot;</span><span class="token punctuation">,</span>
		<span class="token property">&quot;downlevelIteration&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
		<span class="token property">&quot;paths&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
			<span class="token property">&quot;@/*&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;src/*&quot;</span><span class="token punctuation">]</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token property">&quot;include&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;src/**/*.ts&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;src/**/*.tsx&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
	<span class="token property">&quot;exclude&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;node_modules&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h2 id="附2-继续优化" tabindex="-1"><a class="header-anchor" href="#附2-继续优化" aria-hidden="true">#</a> 附2:继续优化</h2><p>没有最好只有更好，虽然我们成功地将代码分离了。<br> 目前我可以看到的是还有这些点可以优化：</p><ol><li>可以将不必要的引入去除（<strong>按需引入</strong>），将第三方库通过es语法<strong>import { }按需引入</strong>而不是import * 这种形式（发现内部库没有做到按需引入的可以自己尝试去做）</li><li>路由使用模块，尽量将公共组件放在一起，将路由和路由使用的库放在一个模块中，这样在加载某一路由的时候不会因为<strong>使用到了另一个路由的代码而将另一个路由同时加载出来</strong>（ps：使用了react的我竟然有些怀念Angular？）</li><li>首屏使用ssr渲染</li></ol><!--]--></div><footer class="page-meta"><div class="meta-item edit-link"><a class="external-link meta-item-label" href="https://github.com/DBSDs/edit/main/Webpack/splitChunks.md" rel="noopener noreferrer" target="_blank" aria-label="Edit this page"><!--[--><!--]--> Edit this page <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!----><!----></footer><nav class="page-nav"><p class="inner"><!----><span class="next"><a href="/Blog/Webpack/module.html" class="" aria-label="全面了解JS中的Module"><!--[--><!--]--> 全面了解JS中的Module <!--[--><!--]--></a></span></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/Blog/assets/app.75b803a6.js" defer></script>
  </body>
</html>
